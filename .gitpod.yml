image:
  file: .gitpod.Dockerfile

tasks:
  - name: API server
    # One time initialization, executed at workspace creation.
    init: |
      cd packages/api
      cp .env.default .env
      npm run migrate:dev:db
      npm install
      psql -c 'CREATE DATABASE "pg-litefarm";'
      psql -c "CREATE DATABASE test_farm;"
      # For local dev setup on Linux, replace next statement with: psql -c "ALTER ROLE postgres WITH PASSWORD 'postgres';"
      #   Details may vary for other OSs.
      psql -c "CREATE ROLE postgres WITH LOGIN SUPERUSER PASSWORD 'postgres';"
      npm run migrate:dev:db
      cd ../..
    # Start up command, executed each time workspace is opened.
    command: cd packages/api && npm start
  - name: Web app server
    # One time initialization, executed at workspace creation.
    init: |
      cd packages/webapp
      cp .env.default .env
      npm install
      cd ../..
    # Start up command, executed each time workspace is opened.
    command: cd packages/webapp && npm start

vscode:
  extensions:
    - dbaeumer.vscode-eslint

ports:
  - port: 3000
    visibility: public
    onOpen: open-browser
  - port: 5000
    visibility: public
    onOpen: ignore
  - port: 5432
    visibility: private
    onOpen: ignore
